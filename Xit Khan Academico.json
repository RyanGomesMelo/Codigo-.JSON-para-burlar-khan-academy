const newWindow = window.open(location.href, "targetWindow", "width=200,height=300,resizable=no");

newWindow.onload = function() {
    // Definindo o originalParse dentro do onload, após a janela ser carregada
    let originalParse = newWindow.JSON.parse;

    newWindow.JSON.parse = function(json, reviver) {
        let parsed = originalParse(json, reviver);
        try {
            const itemData = JSON.parse(parsed.data.assessmentItem.item.itemData);
            if (itemData.question.content.includes("[[")) {
                itemData.question.content = "[[☃ radio 3]]";
                itemData.question.widgets = {
                    "radio 3": {
                        alignment: "default",
                        graded: true,
                        options: {
                            choices: [
                                { content: "Correct answer", correct: true },
                                { content: "Incorrect answer", correct: false }
                            ],
                            deselectEnabled: false
                        },
                        type: "radio"
                    }
                };
                parsed.data.assessmentItem.item.itemData = JSON.stringify(itemData);
            }
        } catch (err) {
            console.error("Failed to parse JSON", err);
        }
        return parsed;
    };

    // Função de recarregar a página na nova janela
    newWindow.location.softReload = () => {
        const pageContent = newWindow.document.getElementsByTagName("html")[0].outerHTML;
        newWindow.document.open();
        newWindow.document.write(pageContent);
        newWindow.document.close();
    };
};
